"use strict";
'use client';
Object.defineProperty(exports, "__esModule", { value: true });
exports.ToasterProvider = void 0;
const tslib_1 = require("tslib");
const jsx_runtime_1 = require("react/jsx-runtime");
const React = tslib_1.__importStar(require("react"));
const getToastIndex_1 = require("../utilities/getToastIndex");
const hasToast_1 = require("../utilities/hasToast");
const removeToast_1 = require("../utilities/removeToast");
const ToasterContext_1 = require("./ToasterContext");
const ToastsContext_1 = require("./ToastsContext");
exports.ToasterProvider = React.forwardRef(function ToasterProvider({ children }, ref) {
    const [toasts, setToasts] = React.useState([]);
    const add = React.useCallback((toast) => {
        const { name } = toast;
        setToasts((toasts) => {
            let nextToasts = toasts;
            if ((0, hasToast_1.hasToast)(toasts, name)) {
                nextToasts = (0, removeToast_1.removeToast)(toasts, name);
            }
            return [
                ...nextToasts,
                Object.assign(Object.assign({}, toast), { addedAt: Date.now(), ref: React.createRef() }),
            ];
        });
    }, []);
    const remove = React.useCallback((toastName) => {
        setToasts((toasts) => {
            return (0, removeToast_1.removeToast)(toasts, toastName);
        });
    }, []);
    const removeAll = React.useCallback(() => {
        setToasts(() => []);
    }, []);
    const update = React.useCallback((toastName, override) => {
        setToasts((toasts) => {
            if (!(0, hasToast_1.hasToast)(toasts, toastName)) {
                return toasts;
            }
            const index = (0, getToastIndex_1.getToastIndex)(toasts, toastName);
            return [
                ...toasts.slice(0, index),
                Object.assign(Object.assign({}, toasts[index]), override),
                ...toasts.slice(index + 1),
            ];
        });
    }, []);
    const toastsRef = React.useRef(toasts);
    React.useEffect(() => {
        toastsRef.current = toasts;
    }, [toasts]);
    const has = React.useCallback((toastName) => {
        return toastsRef.current ? (0, hasToast_1.hasToast)(toastsRef.current, toastName) : false;
    }, []);
    const toasterContext = React.useMemo(() => {
        return {
            add,
            remove,
            removeAll,
            update,
            has,
        };
    }, [add, remove, removeAll, update, has]);
    React.useImperativeHandle(ref, () => ({
        add,
        remove,
        removeAll,
        update,
        has,
    }));
    return ((0, jsx_runtime_1.jsx)(ToasterContext_1.ToasterContext.Provider, { value: toasterContext, children: (0, jsx_runtime_1.jsx)(ToastsContext_1.ToastsContext.Provider, { value: toasts, children: children }) }));
});
exports.ToasterProvider.displayName = 'ToasterProvider';
